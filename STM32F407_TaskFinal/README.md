#Задание 

С использованием средств демо-платы и ОСРВ FreeRTOS реализовать игру под названием 
«Повтори за мной». 
Игра делится на раунды, в каждом раунде она показывает пользователю комбинацию вспышек 
светодиодов. Игрок должен воспроизвести последовательность этих вспышек с помощью кнопок. 
Развитие игры между раундами представляется в виде «снежного кома», это значит, что в новом раунде 
игра показывает все вспышки из предыдущего и дополняет её 1 новой. Пример развития игры из трёх 
раундов для трёх светодиодов может быть следующим: 
1. Пользователь запускает игру. 
2. Первый раунд: включается диод LED1, удерживается некоторое время и гаснет. Игра 
ожидает реакции пользователя. 
3. Пользователь нажимает кнопку S1. Игра принимает это нажатие, как корректное. 
4. Второй раунд: включается диод LED1 (это повтор из первого раунда), удерживается и 
гаснет; затем включается диод LED3, удерживается и гаснет. Игра ожидает реакции 
пользователя. 
5. Пользователь выполняет последовательные нажатия на кнопки S1 и S3. Игра принимает 
последовательность нажатий, как корректную. 
6. Третий раунд: включается диод LED1 (это повтор из первого раунда), удерживается и 
гаснет; включается диод LED3 (это повтор из второго раунда), удерживается и гаснет; затем 
включается диод LED2, удерживается и гаснет. Игра ожидает реакции пользователя. 
7. Пользователь выполняет последовательные нажатия на кнопки S1, S3 и S2. Игра принимает 
последовательность нажатий, как корректную. 
8. Игра завершается, сообщая пользователю, что он корректно воспроизвёл серию вспышек 
последнего раунда. 
9. Если пользователь ошибся при вводе на любом раунде, то игра завершается, сообщая 
пользователю, что он проиграл, т.к. ввёл неправильную последовательность. 
10. Если пользователь затягивает с ответом на любом раунде, то игра завершается, сообщая 
пользователю, что он проиграл, т.к. слишком долго отвечает. 
Цель игры – запомнить комбинацию вспышек светодиодов, предложенную внутренним алгоритмом 
и затем повторить её без ошибок за короткое время с помощью кнопок. 

## Основные условия: 

1. Для отображения комбинации вспышек используются пользовательские светодиоды, для ввода 
используются пользовательские кнопки на демо-плате. Количество определяется разработчиком, но в 
игре должно быть задействовано максимально возможное количество пользовательских светодиодов 
и кнопок. 
2. Для взаимодействия с пользователем (выбор уровня сложности, вывод информационных сообщений) 
должен использоваться последовательный интерфейс UART с параметрами: 115200 бит/с, 8 бит 
данных, 1 стоповый бит, без контроля чётности. 
3. В игре должны присутствовать два уровня сложности. Каждый уровень определяет время, в течение 
которого система будет удерживать светодиод во включённом состоянии для запоминания 
пользователем текущей вспышки. Длительность удержания по уровням, следующая: 
 Первый уровень – 1 секунда, 
 Второй уровень – 0.5 секунды. 
4. Требование к начальному состоянию: после включения и загрузки игра выводит в терминал игроку 
строку приветствия и предлагает выбрать уровень сложности. 
5. Выбор уровня происходит при отправке пользователем соответствующей команды в терминале 
(формат команды: «1» - для первого уровня, «2» - для второго уровня). Игра начинается с задержкой 
2 секунды после выбора сложности, – это необходимо чтобы игрок успел переключить внимание на 
светодиоды и кнопки демо-платы. 
6. Пользователь не может сменить уровень сложности, если уже начал игру. 
7. Каждый элемент «снежного кома» должен быть сгенерирован случайным образом (с использованием 
аппаратного генератора случайных чисел микроконтроллера или с использованием функции rand). 
Любой элемент «снежного кома» всегда соответствует вспышке одного светодиода, не существует 
ситуации, когда элементом является выключенное состояние всех диодов. 
8. Допускается два варианта реализации «снежного кома» (выбирается разработчиком самостоятельно): 
 После запуска игра генерирует массив максимального размера «снежного кома», где каждый 
элемент случайно выбран из диапазона доступных. Игра последовательно на каждом раунде 
показывает соответствующую часть вспышек из этого массива. В этом случае игра заранее 
знает всю последовательность вспышек для самого последнего раунда. 
 После запуска игра генерирует случайным образом вспышку для первого раунда. Затем, при 
успешном развитии, случайно генерирует новую вспышку для второго раунда, увеличивая 
комбинацию. После, при успешном развитии, случайно генерирует новую вспышку для 
третьего раунда (при этом последовательность из первой и второй вспышки не изменяется) и 
т.д. В этом случае игра заранее не знает всю последовательность вспышек для самого 
последнего раунда. 
9. Максимальный размер «снежного кома» установить равным 5 (определить через директиву #define 
для гибкой смены при необходимости). 
10. После отображения всех вспышек на текущем раунде, игра ждёт начала ввода от пользователя. 
Ожидание действия игрока выполнить с использованием программного таймера в интервальном 
режиме с периодом 3 секунды (определить через директиву #define для гибкой смены при 
необходимости). 
11. Каждое нажатие игровых кнопок пользователем: 
 сигнализируется включением соответствующего светодиода, 
 сбрасывает период таймера ожидания действия игрока. 
12. Во время игры, основной алгоритм должен проверять на лету каждое нажатие кнопки пользователем. 
Если во время ввода пользователь допустил ошибку, то игра сразу выводит сообщение в 
последовательный интерфейс о том, что пользователь проиграл и снова предлагает выбрать уровень 
сложности для запуска новой игры. 
13. Если пользователь повторил без ошибок всю комбинацию последнего раунда игры, то происходит три 
вспышки всеми светодиодами. По последовательному интерфейсу передаётся строка поздравления с 
победой и предложение выбрать уровень сложности для старта новый игры. 
14. Новая игра после проигрыша или победы выполняется по аналогичным правилам. 
Последовательность вспышек для «снежного кома» каждой новой игры генерируется в виде новой 
случайной последовательности. 
15. Требование к подсистеме управления памятью – использовать смешанный режим: динамическая 
схема heap_4 и одна из задач реализованной системы должна быть создана со статической аллокацией. 
16. Требование к подсистеме чтения состояния кнопок – использование прерываний с отложенной 
обработкой и механизмом программного антидребезга. Допустимые варианты: 
 С использованием семафора или очереди и отдельной задачи, программный антидребезг на 
примитивной задержке (упрощённый вариант). 
 С использованием очереди и отдельной задачи, программный антидребезг через 
использование механизма программных таймеров в интервальном режиме (усложнённый 
вариант). 
17. Количество задач в системе и их приоритет определяется разработчиком, но с учётом условий 15 и 16. 

## Тест-кейсы 

1. Первое включение игры, выполнение аппаратного сброса. Проверка первичного состояния. 
2. Запуск игры на 1 уровне, успешное прохождение всех раундов. Проверка работы системы обработки 
нажатия кнопок, проверка работы «снежного кома», проверка событий при успешном завершении 
игры. 
3. Запуск игры на 2 уровне, успешное прохождение всех раундов. Проверка влияния выбора более 
сложного уровня на поведение системы, проверка работы системы обработки нажатия кнопок, 
проверка работы «снежного кома» (в т.ч. новой случайной последовательности), проверка состояния 
успешного завершения игры. 
4. Запуск игры на 1 уровне, ошибка на первом раунде (неправильное нажатие). Проверка событий при 
проигрыше игры из-за ошибки, проверка готовности системы к новой игре. 
5. Запуск игры на 1 уровне, ошибка на втором раунде (неправильное нажатие). Проверка событий при 
проигрыше игры из-за ошибки, проверка готовности системы к новой игре. 
6. Запуск игры на 1 уровне, отсутствие реакции пользователя (ожидание таймаута игры). Проверка 
событий при проигрыше игры по таймауту, проверка готовности системы к новой игре. 
Критерии готовности (Definition of Done) 
1. Проект собирается и загружается в отладочную плату без ошибок и предупреждений. 
2. По последовательному порту передаются сообщения от игры без искажений и нарушений следования 
символов. Игра реагирует только на заданные команды пользователя и корректно исполняет их. 
3. Игра успешно протестирована по предложенным тест-кейсам (допускается дополнительная проверка 
по тест-кейсам по выбору разработчика). 
4. Поведение игры соответствует описанному сценарию для той или иной ситуации. 

## Замечания 

1. Решение оформляется проектом с именем «Task_Final». В начале файла «main.c» должен идти блок 
комментариев, в котором приводится краткое описание логики задач системы и задействованные в 
решении аппаратные ресурсы демо-платы (кнопки, светодиоды, выводы портов связи). 
2. Для вывода строк использовать примитивную функцию отправки пакета байт по UART вместо 
функции printf.

## Использованные аппаратные ресурсы

- Порт RS232 115200 бод
- Светодиоды LED1-3
- Кнопка S1-3
